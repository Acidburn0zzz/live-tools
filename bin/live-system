#!/bin/sh

## live-tools(7) - System Support Scripts
## Copyright (C) 2006-2013 Daniel Baumann <mail@daniel-baumann.ch>
##
## This program is free software: you can redistribute it and/or modify
## it under the terms of the GNU General Public License as published by
## the Free Software Foundation, either version 3 of the License, or
## (at your option) any later version.
##
## This program is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
## GNU General Public License for more details.
##
## You should have received a copy of the GNU General Public License
## along with this program. If not, see <http://www.gnu.org/licenses/>.
##
## The complete text of the GNU General Public License
## can be found in /usr/share/common-licenses/GPL-3 file.


# Redirect stdout to stderr
exec 1>&2

case "${1}" in
	-h|--help|-u|--usage)
		echo "live-system - determine if running system is a live system"
		echo
		echo "Usage: ${0} [-v|--verbose]"

		exit 2
		;;

	-v|--verbose)
		_VERBOSE="true"
		;;
esac

[ "${_VERBOSE}" ] && echo -n "Checking for live system..."

if [ ! -e /proc/cmdline ]
then
	[ "${_VERBOSE}" ] && echo
	echo "E: /proc/cmdline - No such file."

	exit 2
fi

if grep -qs "boot=live" /proc/cmdline
then
	[ "${_VERBOSE}" ] && echo -n " yes, this is a live system"

	if [ -d /lib/live/mount/medium/install ]
	then
		if ls /lib/live/mount/medium/install/pool/main/l/live-installer/live-installer_*.udeb > /dev/null 2>&1
		then
			[ "${_VERBOSE}" ] && echo " with debian-installer (live) support."
		else
			[ "${_VERBOSE}" ] && echo " with debian-installer (normal) support."
		fi
	else
		[ "${_VERBOSE}" ] && echo "without debian-installer support."
	fi

	exit 0
else
	[ "${_VERBOSE}" ] && echo " no, this is not a live system."

	exit 1
fi
